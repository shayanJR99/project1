# -*- coding: utf-8 -*-
from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer
from reportlab.lib.pagesizes import A4
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont
from reportlab.lib.styles import ParagraphStyle
from reportlab.lib.units import inch
import arabic_reshaper
from bidi.algorithm import get_display

# مسیر خروجی PDF
output_pdf = "/home/shayanjr/programing/project1/files/afghanisstan.pdf"

# ثبت فونت فارسی
pdfmetrics.registerFont(
    TTFont("Vazir", "/project1/files/fonts/Vazirmatn-Regular.ttf")
)

# استایل‌ها با فونت فارسی
title_style = ParagraphStyle('title', fontName='Vazir', fontSize=18, leading=22)
section_style = ParagraphStyle('section', fontName='Vazir', fontSize=14, leading=18)
normal_style = ParagraphStyle('normal', fontName='Vazir', fontSize=12, leading=16)

# تابع برای راست‌به‌چپ کردن متن فارسی
def fix_rtl(text):
    reshaped_text = arabic_reshaper.reshape(text)
    return get_display(reshaped_text)

# ایجاد سند
doc = SimpleDocTemplate(output_pdf, pagesize=A4)
elements = []

# عنوان اصلی
elements.append(Paragraph(fix_rtl("تاریخ افغانستان پس از جدایی از ایران"), title_style))
elements.append(Spacer(1, 0.3 * inch))

# بخش‌ها و محتوا
sections = {
"۱) شکل‌گیری افغانستان مستقل (۱۷۴۷–۱۸۲۳)": """
پس از فروپاشی دولت صفویه و دوره آشوب در ایران، احمدشاه درانی در سال ۱۷۴۷ میلادی حکومت مستقلی را پایه‌گذاری کرد که هسته اصلی افغانستان امروزی شد. 
او قبایل پشتون را متحد کرد و قلمرو خود را تا بخش‌هایی از ایران، هند و آسیای میانه گسترش داد. 
با این حال ساختار حکومت بیشتر قبیله‌ای بود و تمرکز قدرت ضعیف باقی ماند. 
پس از مرگ او، اختلافات داخلی باعث کاهش ثبات سیاسی شد.
""",

"۲) بازی بزرگ و جنگ‌های انگلیس (۱۸۲۳–۱۹۱۹)": """
در قرن نوزدهم، افغانستان به منطقه حائل میان امپراتوری بریتانیا در هند و روسیه تزاری تبدیل شد. 
این رقابت که به «بازی بزرگ» مشهور است، موجب سه جنگ میان افغانستان و بریتانیا شد. 
اگرچه افغانستان استقلال داخلی داشت، سیاست خارجی آن تا حد زیادی تحت نفوذ بریتانیا بود. 
این دوره با بی‌ثباتی سیاسی و ضعف اقتصادی همراه بود.
""",

"۳) استقلال کامل و اصلاحات (۱۹۱۹–۱۹۷۳)": """
پس از جنگ سوم با بریتانیا در سال ۱۹۱۹، افغانستان کنترل کامل سیاست خارجی خود را به دست آورد. 
امان‌الله خان اصلاحات گسترده‌ای در زمینه آموزش، حقوق زنان و نوسازی اداری آغاز کرد. 
اما مقاومت سنتی‌ها و فشارهای داخلی باعث عقب‌نشینی بخشی از این اصلاحات شد. 
در دهه‌های بعد، حکومت پادشاهی تلاش کرد مسیر مدرنیزاسیون تدریجی را ادامه دهد.
""",

"۴) کودتا و دوره کمونیستی (۱۹۷۳–۱۹۷۹)": """
در سال ۱۹۷۳ نظام پادشاهی با کودتا سقوط کرد و جمهوری اعلام شد. 
در سال ۱۹۷۸ انقلاب ثور به رهبری حزب دموکراتیک خلق افغانستان رخ داد و حکومت کمونیستی بر سر کار آمد. 
اصلاحات اجباری و سرکوب مخالفان باعث شورش‌های گسترده شد. 
دولت جدید به شدت به اتحاد جماهیر شوروی نزدیک شد.
""",

"۵) اشغال شوروی (۱۹۷۹–۱۹۸۹)": """
در سال ۱۹۷۹ ارتش شوروی برای حمایت از دولت کمونیستی وارد افغانستان شد. 
جنگی ده‌ساله میان نیروهای شوروی و مجاهدین افغان آغاز شد. 
مجاهدین از حمایت آمریکا، پاکستان و برخی کشورهای دیگر برخوردار بودند. 
این جنگ خسارات سنگینی به زیرساخت‌ها وارد کرد و میلیون‌ها نفر آواره شدند.
""",

"۶) جنگ داخلی مجاهدین (۱۹۸۹–۱۹۹۶)": """
پس از خروج شوروی، اختلاف میان گروه‌های مجاهدین شدت گرفت. 
درگیری‌های خونین برای کنترل کابل و سایر شهرها ادامه یافت. 
ساختار دولت مرکزی فروپاشید و فرماندهان محلی قدرت را در دست گرفتند. 
پایتخت افغانستان آسیب گسترده‌ای دید.
""",

"۷) حکومت اول طالبان (۱۹۹۶–۲۰۰۱)": """
جنبش طالبان با شعار برقراری امنیت ظهور کرد و در سال ۱۹۹۶ کابل را تصرف نمود. 
این گروه قوانین سخت‌گیرانه‌ای بر اساس تفسیر خاص خود از شریعت اعمال کرد. 
حقوق زنان به شدت محدود شد و افغانستان در انزوای بین‌المللی قرار گرفت.
""",

"۸) مداخله آمریکا و جمهوری اسلامی افغانستان (۲۰۰۱–۲۰۲۱)": """
پس از حملات ۱۱ سپتامبر ۲۰۰۱، ایالات متحده و متحدانش به افغانستان حمله کردند و حکومت طالبان را سرنگون نمودند. 
نظام جمهوری با برگزاری انتخابات و تدوین قانون اساسی جدید شکل گرفت. 
با وجود کمک‌های بین‌المللی، فساد اداری، ضعف ساختاری و وابستگی شدید به نیروهای خارجی ادامه داشت.
""",

"۹) بازگشت طالبان (۲۰۲۱ تاکنون)": """
در سال ۲۰۲۱ با خروج نیروهای آمریکایی، دولت جمهوری به سرعت سقوط کرد و طالبان دوباره قدرت را به دست گرفت. 
تغییرات سیاسی و اجتماعی گسترده‌ای رخ داد و وضعیت حقوق بشر، به ویژه برای زنان، با چالش‌های جدی روبه‌رو شد. 
افغانستان همچنان با بحران اقتصادی و انزوای بین‌المللی مواجه است.
"""
}

# اضافه کردن بخش‌ها به سند
for title, content in sections.items():
    elements.append(Paragraph(fix_rtl(title), section_style))
    elements.append(Spacer(1, 0.2 * inch))
    elements.append(Paragraph(fix_rtl(content), normal_style))
    elements.append(Spacer(1, 0.4 * inch))

# ساخت PDF
doc.build(elements)

print("PDF ساخته شد:", output_pdf)
